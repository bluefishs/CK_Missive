# CK_Missive ç³»çµ±æ¶æ§‹ç‹€æ…‹å ±å‘Š

> å ±å‘Šæ—¥æœŸ: 2026-01-05

---

## ä¸€ã€æœå‹™é‹è¡Œç‹€æ…‹

| æœå‹™åç¨± | ç‹€æ…‹ | ç«¯å£ | èªªæ˜ |
|---------|------|------|------|
| ck_missive_backend | âœ… Up (healthy) | 8001â†’8000 | FastAPI å¾Œç«¯ |
| ck_missive_postgres | âœ… Up (healthy) | 5434â†’5432 | PostgreSQL è³‡æ–™åº« |
| ck_missive_redis | âœ… Up (healthy) | 6380â†’6379 | Redis å¿«å– |
| ck_missive_adminer_dev | âœ… Up | 8080 | è³‡æ–™åº«ç®¡ç†ä»‹é¢ |
| Frontend (Vite) | âœ… é–‹ç™¼æ¨¡å¼ | 3000 | React + Ant Design |

---

## äºŒã€è³‡æ–™åº«çµæ§‹

### æ ¸å¿ƒè³‡æ–™è¡¨ (14 å¼µ)

| è³‡æ–™è¡¨ | ç”¨é€” | é—œè¯ |
|--------|------|------|
| `documents` | å…¬æ–‡ç®¡ç† | â†’ contract_projects (FK) |
| `contract_projects` | æ‰¿æ”¬æ¡ˆä»¶ | â† documents, project_user_assignments, project_vendor_association |
| `users` | ä½¿ç”¨è€… | â† project_user_assignments |
| `partner_vendors` | å”åŠ›å» å•† | â† project_vendor_association |
| `government_agencies` | æ©Ÿé—œå–®ä½ | ç¨ç«‹ |
| `document_attachments` | å…¬æ–‡é™„ä»¶ | â†’ documents (FK) |
| `document_calendar_events` | æ—¥æ›†äº‹ä»¶ | â†’ documents (FK) |
| `project_user_assignments` | å°ˆæ¡ˆäººå“¡æŒ‡æ´¾ | â†’ contract_projects, users |
| `project_vendor_association` | å°ˆæ¡ˆå» å•†é—œè¯ | â†’ contract_projects, partner_vendors |
| `event_reminders` | äº‹ä»¶æé†’ | â†’ document_calendar_events |
| `site_configurations` | ç«™å°è¨­å®š | ç³»çµ±è¨­å®š |
| `site_navigation_items` | å°è¦½é¸å–® | æ¨¹ç‹€çµæ§‹ |
| `system_notifications` | ç³»çµ±é€šçŸ¥ | ç¨ç«‹ |
| `user_sessions` | ä½¿ç”¨è€…æœƒè©± | â†’ users |

### å…¬æ–‡çµ±è¨ˆé©—è­‰

```
category  | count
----------+-------
æ”¶æ–‡      |   333
ç™¼æ–‡      |   169
ç¸½è¨ˆ      |   502
```

---

## ä¸‰ã€å‰å¾Œç«¯ API å°æ‡‰

### å…¬æ–‡ç®¡ç† `/api/documents-enhanced`

| API ç«¯é» | æ–¹æ³• | å‰ç«¯å‘¼å«ä½ç½® | ç‹€æ…‹ |
|---------|------|-------------|------|
| `/integrated-search` | GET | documents.ts | âœ… æ­£å¸¸ |
| `/statistics` | GET | documents.ts | âœ… å·²ä¿®æ­£ (category æ¬„ä½) |
| `/document-years` | GET | DocumentFilter.tsx | âœ… æ­£å¸¸ |
| `/contract-projects-dropdown` | GET | DocumentFilter.tsx | âœ… æ­£å¸¸ |
| `/agencies-dropdown` | GET | DocumentFilter.tsx | âœ… æ­£å¸¸ |

### æ‰¿æ”¬æ¡ˆä»¶ `/api/projects`

| API ç«¯é» | æ–¹æ³• | å‰ç«¯å‘¼å«ä½ç½® | ç‹€æ…‹ |
|---------|------|-------------|------|
| `/` | GET | ContractCasePage.tsx | âœ… æ­£å¸¸ |
| `/{id}` | GET | ContractCaseDetailPage.tsx | âœ… æ­£å¸¸ |
| `/` | POST | ContractCaseFormPage.tsx | âœ… æ­£å¸¸ |
| `/{id}` | PUT | ContractCaseFormPage.tsx | âœ… æ­£å¸¸ |
| `/statistics` | GET | ContractCasePage.tsx | âœ… æ­£å¸¸ |

### ä½¿ç”¨è€…ç®¡ç† `/api/users` (POST-only æ©Ÿåˆ¶)

| API ç«¯é» | æ–¹æ³• | å‰ç«¯å‘¼å«ä½ç½® | ç‹€æ…‹ |
|---------|------|-------------|------|
| `/` | GET | StaffPage.tsx | âœ… æ­£å¸¸ |
| `/` | POST | StaffPage.tsx (æ–°å¢) | âœ… æ­£å¸¸ |
| `/{id}/update` | POST | StaffPage.tsx (ç·¨è¼¯) | âœ… æ­£å¸¸ |
| `/{id}/delete` | POST | StaffPage.tsx (åˆªé™¤) | âœ… æ­£å¸¸ |
| `/{id}/status` | POST | StaffPage.tsx (ç‹€æ…‹) | âœ… æ­£å¸¸ |

### å”åŠ›å» å•† `/api/vendors`

| API ç«¯é» | æ–¹æ³• | å‰ç«¯å‘¼å«ä½ç½® | ç‹€æ…‹ |
|---------|------|-------------|------|
| `/` | GET | VendorPage.tsx | âœ… æ­£å¸¸ (å…èªè­‰) |
| `/` | POST | VendorPage.tsx | âœ… æ­£å¸¸ |
| `/{id}` | PUT | VendorPage.tsx | âœ… æ­£å¸¸ |
| `/{id}` | DELETE | VendorPage.tsx | âœ… æ­£å¸¸ |

### å°ˆæ¡ˆé—œè¯ `/api/project-vendors`

| API ç«¯é» | æ–¹æ³• | å‰ç«¯å‘¼å«ä½ç½® | ç‹€æ…‹ |
|---------|------|-------------|------|
| `/project/{id}` | GET | ContractCaseDetailPage.tsx | âœ… æ­£å¸¸ |
| `/` | POST | ContractCaseDetailPage.tsx | âœ… æ­£å¸¸ |
| `/project/{id}/vendor/{vid}` | DELETE | ContractCaseDetailPage.tsx | âœ… æ­£å¸¸ |

---

## å››ã€å·²å®Œæˆä¿®å¾©é …ç›®

### æœ¬æ¬¡æœƒè©±å®Œæˆ
1. âœ… **å…¬æ–‡å„€è¡¨æ¿å„ªåŒ–** - ç§»é™¤é‡è¤‡çµ±è¨ˆå¡ç‰‡
2. âœ… **æ”¶ç™¼æ–‡çµ±è¨ˆä¿®æ­£** - ä½¿ç”¨ `category` æ¬„ä½ (åŸéŒ¯èª¤ä½¿ç”¨ `doc_type`)
3. âœ… **ç¯©é¸å€æ”¶é—”æ©Ÿåˆ¶** - é è¨­æ”¶é—”ï¼Œå…¬æ–‡è³‡è¨Šæœ€å¤§åŒ–
4. âœ… **StaffPage CRUD** - POST-only æ©Ÿåˆ¶ + è¡¨å–®é‡ç½®ä¿®å¾©
5. âœ… **æ¡ˆä»¶é¡åˆ¥çµ±ä¸€** - "æ¡ˆä»¶æ€§è³ª" â†’ "æ¡ˆä»¶é¡åˆ¥" è¡“èªçµ±ä¸€
6. âœ… **é¡åˆ¥å°æ‡‰æ­£è¦åŒ–** - CATEGORY_MAP è™•ç† 01/å§”è¾¦æ¡ˆä»¶/01å§”è¾¦æ¡ˆä»¶ ç­‰æ ¼å¼

### æ­·å²ä¿®å¾©
- DocumentList æ’åºç¯©é¸ã€æ¬„å¯¬å„ªåŒ–
- Vendors API èªè­‰å•é¡Œ
- ProjectStaff è§’è‰²é©—è­‰æ“´å±•
- 422 Pydantic éŒ¯èª¤è™•ç†
- CORS è¨­å®šä¿®å¾©

---

## äº”ã€å¾…è™•ç†é …ç›®

### ğŸ”´ é«˜å„ªå…ˆ

| é …ç›® | èªªæ˜ | å½±éŸ¿ç¯„åœ |
|------|------|---------|
| ContractCaseDetailPage TAB æ•´åˆ | 4 å€‹åˆ†é  (åŸºæœ¬/åŒä»/å» å•†/æ–‡ä»¶) | æ¡ˆä»¶è©³æƒ…é  |
| å°ˆæ¡ˆé—œè¯æ–‡ä»¶ API | GET/POST/DELETE `/projects/{id}/documents` | æ¡ˆä»¶è©³æƒ…é  TAB 4 |
| VendorPage CRUD | å» å•†åˆ—è¡¨èˆ‡ç·¨è¼¯åŠŸèƒ½ | å» å•†ç®¡ç†é  |
| AgenciesPage CRUD | æ©Ÿé—œåˆ—è¡¨èˆ‡ç·¨è¼¯åŠŸèƒ½ | æ©Ÿé—œç®¡ç†é  |

### ğŸŸ¡ ä¸­å„ªå…ˆ

| é …ç›® | èªªæ˜ |
|------|------|
| è¡Œäº‹æ›†æ•´åˆ | CalendarPage èˆ‡å…¬æ–‡äº‹ä»¶é€£å‹• |
| ç™¼æ–‡å­—è™Ÿç®¡ç† | DocumentNumbersPage è‡ªå‹•ç·¨è™Ÿ |
| ä½¿ç”¨è€…æ¬Šé™ç®¡ç† | Role-based access control |
| Dashboard çµ±è¨ˆåœ–è¡¨ | è¦–è¦ºåŒ–å ±è¡¨ |

### ğŸŸ¢ ä½å„ªå…ˆ (å„ªåŒ–)

- æ¸›å°‘ API é‡è¤‡å‘¼å«
- TypeScript å‹åˆ¥å®Œå–„
- Ant Design è­¦å‘Šè™•ç† (overlayStyle, onDropdownVisibleChange)
- å–®å…ƒæ¸¬è©¦è¦†è“‹

---

## å…­ã€å·²çŸ¥è­¦å‘Šèˆ‡å»ºè­°

### Ant Design è­¦å‘Š

```
âš ï¸ [antd: Tooltip] `overlayStyle` is deprecated â†’ ä½¿ç”¨ `styles={{ root: {} }}`
âš ï¸ [antd: message] Static function can not consume context â†’ ä½¿ç”¨ App.useApp()
âš ï¸ [antd: Select] `onDropdownVisibleChange` is deprecated â†’ ä½¿ç”¨ `onOpenChange`
```

**å»ºè­°**: å»ºç«‹æŠ€è¡“å‚µæ¸…å–®ï¼Œåœ¨åŠŸèƒ½ç©©å®šå¾Œçµ±ä¸€å‡ç´š Ant Design ç”¨æ³•ã€‚

### API è¨­è¨ˆå»ºè­°

1. **POST-only æ©Ÿåˆ¶ä¸€è‡´æ€§**
   - ç›®å‰åƒ… `/api/users` ä½¿ç”¨ POST-only
   - å»ºè­°: è©•ä¼°æ˜¯å¦å…¨ç³»çµ±çµ±ä¸€ï¼Œæˆ–ç¶­æŒ RESTful æ¨™æº–

2. **éŒ¯èª¤å›æ‡‰æ ¼å¼çµ±ä¸€**
   - å»ºè­°: å®šç¾©çµ±ä¸€çš„ ErrorResponse schema
   ```json
   { "error": { "code": "ERR_XXX", "message": "...", "details": {} } }
   ```

3. **åˆ†é å›æ‡‰æ ¼å¼çµ±ä¸€**
   - ç›®å‰æœ‰ `items/documents`ã€`total/count`ã€`page/current` ç­‰ä¸åŒå‘½å
   - å»ºè­°: çµ±ä¸€ç‚º `{ items, total, page, limit, total_pages }`

### æ•ˆèƒ½å»ºè­°

1. **API å¿«å–ç­–ç•¥**
   - ä¸‹æ‹‰é¸é … (agencies, vendors, projects) é©åˆå¿«å–
   - å»ºè­° TTL: 5-10 åˆ†é˜

2. **å‰ç«¯ React Query å„ªåŒ–**
   - åˆ©ç”¨ `staleTime` æ¸›å°‘é‡è¤‡è«‹æ±‚
   - åˆ©ç”¨ `prefetch` é è¼‰å¸¸ç”¨è³‡æ–™

---

## ä¸ƒã€ç³»çµ±æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (React + Vite)                   â”‚
â”‚                      localhost:3000                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚Documentsâ”‚ â”‚Projects â”‚ â”‚ Staff   â”‚ â”‚ Vendors/Agencies    â”‚â”‚
â”‚  â”‚  Page   â”‚ â”‚  Page   â”‚ â”‚  Page   â”‚ â”‚      Pages          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚           â”‚           â”‚                  â”‚           â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                           â”‚                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚  API Client â”‚                          â”‚
â”‚                    â”‚  (Axios)    â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚   FastAPI   â”‚                          â”‚
â”‚                    â”‚ localhost:8001                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                           â”‚                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚                       â”‚                       â”‚         â”‚
â”‚   â–¼                       â–¼                       â–¼         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚documentsâ”‚         â”‚  projects â”‚          â”‚   users   â”‚   â”‚
â”‚ â”‚_enhancedâ”‚         â”‚           â”‚          â”‚           â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â”‚                    â”‚                      â”‚         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                           â”‚                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                    â”‚  PostgreSQL â”‚                         â”‚
â”‚                    â”‚ localhost:5434                        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                            â”‚
â”‚                    Backend (Docker)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*å ±å‘Šç”¢ç”Ÿæ™‚é–“: 2026-01-05*
