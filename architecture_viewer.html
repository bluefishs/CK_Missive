<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹¾å¤æ¸¬ç¹ªå…¬æ–‡ç³»çµ± - æ¶æ§‹æª¢è¦–å™¨</title>
    <style>
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”'; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .api-section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .endpoint { background: white; padding: 10px; margin: 5px 0; border-left: 4px solid #1890ff; }
        .method { display: inline-block; padding: 2px 8px; border-radius: 3px; color: white; font-size: 12px; }
        .GET { background: #52c41a; }
        .POST { background: #1890ff; }
        .PUT { background: #fa8c16; }
        .DELETE { background: #ff4d4f; }
        button { padding: 10px 20px; margin: 5px; background: #1890ff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .response { background: #f0f0f0; padding: 10px; margin-top: 10px; border-radius: 3px; white-space: pre-wrap; font-family: monospace; }
        #status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .error { background: #fff2f0; color: #ff4d4f; border: 1px solid #ffccc7; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¢ ä¹¾å¤æ¸¬ç¹ªå…¬æ–‡ç®¡ç†ç³»çµ±æ¶æ§‹æª¢è¦–å™¨</h1>
        
        <div id="status" class="success">
            <strong>ç³»çµ±ç‹€æ…‹:</strong> æ­£åœ¨æª¢æŸ¥æœå‹™...
        </div>

        <div class="api-section">
            <h2>ğŸ“¡ APIç«¯é»æª¢è¦–</h2>
            <p>é€™è£¡å¯ä»¥æª¢è¦–æ‰€æœ‰çš„å‰ç«¯-å¾Œç«¯å°æ‡‰é—œä¿‚</p>
            
            <div class="endpoint">
                <span class="method GET">GET</span>
                <strong>/api/documents/</strong> - å–å¾—æ–‡ä»¶åˆ—è¡¨
                <button onclick="testAPI('GET', '/api/documents/?limit=3')">æ¸¬è©¦</button>
                <div id="response-documents-get" class="response" style="display:none;"></div>
            </div>

            <div class="endpoint">
                <span class="method POST">POST</span>
                <strong>/api/documents/import</strong> - CSVåŒ¯å…¥
                <button onclick="showImportForm()">æ¸¬è©¦åŒ¯å…¥</button>
                <div id="import-form" style="display:none; margin-top:10px;">
                    <input type="file" id="csvFile" accept=".csv" />
                    <button onclick="testCSVImport()">åŸ·è¡ŒåŒ¯å…¥</button>
                </div>
                <div id="response-import" class="response" style="display:none;"></div>
            </div>

            <div class="endpoint">
                <span class="method GET">GET</span>
                <strong>/health</strong> - å¥åº·æª¢æŸ¥
                <button onclick="testAPI('GET', '/health')">æ¸¬è©¦</button>
                <div id="response-health" class="response" style="display:none;"></div>
            </div>
        </div>

        <div class="api-section">
            <h2>ğŸ—‚ï¸ æª”æ¡ˆæ¶æ§‹å°æ‡‰</h2>
            <table border="1" style="width:100%; border-collapse: collapse;">
                <tr style="background: #fafafa;">
                    <th style="padding: 10px;">å‰ç«¯æª”æ¡ˆ</th>
                    <th style="padding: 10px;">å¾Œç«¯æª”æ¡ˆ</th>
                    <th style="padding: 10px;">åŠŸèƒ½å°æ‡‰</th>
                </tr>
                <tr>
                    <td style="padding: 8px;">frontend/src/services/documentAPI.js</td>
                    <td style="padding: 8px;">backend/app/api/endpoints/documents.py</td>
                    <td style="padding: 8px;">æ–‡ä»¶CRUDæ“ä½œ</td>
                </tr>
                <tr>
                    <td style="padding: 8px;">frontend/src/components/Documents/DocumentImport.jsx</td>
                    <td style="padding: 8px;">backend/csv_processor.py</td>
                    <td style="padding: 8px;">CSVåŒ¯å…¥è™•ç†</td>
                </tr>
                <tr>
                    <td style="padding: 8px;">frontend/src/api/config.ts</td>
                    <td style="padding: 8px;">backend/main.py</td>
                    <td style="padding: 8px;">APIåŸºç¤é…ç½®</td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8001';
        
        // æª¢æŸ¥æœå‹™ç‹€æ…‹
        async function checkServiceStatus() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                if (response.ok) {
                    document.getElementById('status').innerHTML = '<strong>âœ… ç³»çµ±ç‹€æ…‹:</strong> å¾Œç«¯æœå‹™æ­£å¸¸é‹è¡Œ';
                    document.getElementById('status').className = 'success';
                } else {
                    throw new Error('æœå‹™ç•°å¸¸');
                }
            } catch (error) {
                document.getElementById('status').innerHTML = '<strong>âŒ ç³»çµ±ç‹€æ…‹:</strong> å¾Œç«¯æœå‹™ç„¡æ³•é€£æ¥';
                document.getElementById('status').className = 'error';
            }
        }

        // æ¸¬è©¦API
        async function testAPI(method, endpoint) {
            const responseId = 'response-' + endpoint.replace(/[^a-z]/gi, '-');
            const responseDiv = document.getElementById(responseId) || createResponseDiv(endpoint);
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, { method });
                const data = await response.json();
                responseDiv.textContent = JSON.stringify(data, null, 2);
                responseDiv.style.display = 'block';
            } catch (error) {
                responseDiv.textContent = `éŒ¯èª¤: ${error.message}`;
                responseDiv.style.display = 'block';
            }
        }

        function createResponseDiv(endpoint) {
            const div = document.createElement('div');
            div.className = 'response';
            div.id = 'response-' + endpoint.replace(/[^a-z]/gi, '-');
            return div;
        }

        function showImportForm() {
            document.getElementById('import-form').style.display = 'block';
        }

        async function testCSVImport() {
            const fileInput = document.getElementById('csvFile');
            const responseDiv = document.getElementById('response-import');
            
            if (!fileInput.files[0]) {
                alert('è«‹é¸æ“‡CSVæª”æ¡ˆ');
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch(`${API_BASE}/api/documents/import`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                responseDiv.textContent = JSON.stringify(data, null, 2);
                responseDiv.style.display = 'block';
            } catch (error) {
                responseDiv.textContent = `éŒ¯èª¤: ${error.message}`;
                responseDiv.style.display = 'block';
            }
        }

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥ç‹€æ…‹
        checkServiceStatus();
        setInterval(checkServiceStatus, 30000); // æ¯30ç§’æª¢æŸ¥ä¸€æ¬¡
    </script>
</body>
</html>